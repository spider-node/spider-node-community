import{a as j,u as A}from"./log.c68a8790.js";import{u as B}from"./index.6a0f63a4.js";import{c as H,e as J,q as Y,r as W,u as G}from"./menu.46469ad7.js";import{b as V,r as f,g as p,o as k,v as C,w as m,a as F,x as O,e as Q,i,c as q,l as D,k as L,u as R,F as $,G as E,V as X,y as Z,T as ee,$ as P}from"./index.a3be559f.js";import{i as N}from"./types.22d094ed.js";import{b as T}from"./sdk.dc44f240.js";import"./index.a443cb70.js";const te=["textContent"],ae={__name:"exceptionDialog",props:{title:{type:String,default:"\u5F02\u5E38\u4FE1\u606F"}},setup(t,{expose:a}){const e=f(!1),n=f(""),d=o=>{n.value=o.exception+o.exception+o.exception,e.value=!0},u=o=>{o()};return a({show:d}),(o,_)=>{const g=p("yun-dialog");return k(),C(g,{modelValue:e.value,"onUpdate:modelValue":_[0]||(_[0]=y=>e.value=y),title:t.title,size:"large","confirm-button-handler":u,"confirm-button-text":"\u5173\u95ED","show-cancel-button":!1},{default:m(()=>[F("div",{class:"info",textContent:O(n.value)},null,8,te)]),_:1},8,["modelValue","title"])}}};var le=V(ae,[["__scopeId","data-v-018fd51a"]]),ne={__name:"detail",setup(t,{expose:a}){const e=f(!1),n=f(""),d=f(),u=f(),o={page:1,size:10,total:0};async function _({pagination:s}){const{page:c,size:x}=s,S=await j({requestId:n.value,page:c,size:x});return{...S,records:S.elementExampleList.map(w=>{const{oilCard:l,...r}=w;return{...r,...l}})}}const g=async s=>{n.value=s.id,e.value=!0},y=Q(()=>[{label:"\u529F\u80FD\u540D\u79F0",prop:"functionName"},{prop:"flowElementName",label:"\u8282\u70B9\u540D\u79F0"},{prop:"status",label:"\u6267\u884C\u72B6\u6001",render:({row:s})=>s.status==="SUSS"?"\u6210\u529F":"\u5931\u8D25"},{label:"\u5165\u53C2",prop:"requestParam",width:320,render:({row:s})=>i(p("json-viewer"),{value:s.requestParam,copyable:!0,sort:!0,"expand-depth":0},null)},{label:"\u51FA\u53C2",prop:"returnParam",width:320,render:({row:s})=>i(p("json-viewer"),{value:s.returnParam,copyable:!0,sort:!0,"expand-depth":0},null)},{label:"\u8017\u65F6",prop:"takeTime",render:({row:s})=>`${s.takeTime||"0"}ms`},{label:"\u5F02\u5E38\u4FE1\u606F",prop:"exception"}]);function b(s){u.value.show(s)}return a({show:g}),(s,c)=>{const x=p("el-button"),S=p("yun-pro-table"),w=p("yun-drawer");return k(),q($,null,[i(w,{modelValue:e.value,"onUpdate:modelValue":c[1]||(c[1]=l=>e.value=l),title:"\u8BE6\u60C5",size:"X-large"},{default:m(()=>[e.value?(k(),C(S,{key:0,ref_key:"tableRef",ref:d,pagination:o,"onUpdate:pagination":c[0]||(c[0]=l=>o=l),"table-columns":R(y),"remote-method":_,"table-props":{stripe:!1}},{t_exception:m(({row:l})=>[l.status!=="SUSS"?(k(),C(x,{key:0,type:"action",onClick:r=>b(l)},{default:m(()=>[D(" \u67E5\u770B\u8BE6\u7EC6 ")]),_:2},1032,["onClick"])):L("v-if",!0)]),_:1},8,["table-columns"])):L("v-if",!0)]),_:1},8,["modelValue"]),i(le,{ref_key:"exceptionDialogRef",ref:u},null,512)],64)}}};const se={props:{multiple:{type:Boolean,default:!1},limit:{type:Number,default:20},accept:{type:String,default:"*"},listType:{type:String,default:"text"},tips:{type:String,default:""},value:{type:Array,default:()=>[]},beforeUpload:{type:Function,default:t=>t&&t.size>1024*1024*10?(E.warning("\u6587\u4EF6\u5927\u5C0F\u4E0D\u80FD\u8D85\u8FC710M\uFF01"),!1):!0},beforeRemove:{type:Function,default:()=>!0},uploadMethod:{type:Function,default:()=>T}},emits:["fileChange"],data(){return{loading:{httpRequest:!1},fileName:void 0,fileList:[],uploadFileList:[],imgUrl:""}},watch:{value:{immediate:!0,deep:!0,handler(t){const a=[];t.forEach(e=>{const n={name:e.fileName,url:e.fileUrl,...e};a.push(n)}),this.fileList=a,this.uploadFileList=a}}},created(){},methods:{async httpRequest({file:t}){try{this.loading.httpRequest=!0;const a=t.name.lastIndexOf("."),e=t.name.slice(a+1),n=new FormData;n.append("file",t),n.append("fileExtension",e);const d=await T(n);this.loading.httpRequest=!1;const u={fileName:t.name,fileUrl:d.patch,uuid:t.uid};this.uploadFileList=[u],this.handSubmit()}finally{this.loading.httpRequest=!1}},handSubmit(){const t=this.uploadFileList.map(a=>a);this.$emit("fileChange",t)},handleRemove(t){const a=this.uploadFileList.findIndex(e=>e.uid===t.uid);a!==-1&&this.uploadFileList.splice(a,1),this.handSubmit()},handleExceed(t,a){this.$message.warning(`\u5F53\u524D\u9650\u5236\u9009\u62E9 ${this.limit} \u4E2A\u6587\u4EF6\uFF0C\u672C\u6B21\u9009\u62E9\u4E86 ${t.length} \u4E2A\u6587\u4EF6\uFF0C\u5171\u9009\u62E9\u4E86 ${t.length+a.length} \u4E2A\u6587\u4EF6`)},isImageFile(t){const a=["bmp","jpeg","jpg","png","tif","gif","pcx","tga","exif","fpx","svg","psd","cdr","pcd","dxf","ufo","eps","ai","raw","WMF","webp"],e=t.lastIndexOf("."),n=t.substring(e+1);return a.indexOf(n)>-1}}},oe={class:"file_upload"},re={class:"el-upload__tip"};function ie(t,a,e,n,d,u){const o=p("el-button"),_=p("el-upload"),g=X("loading");return k(),q("div",oe,[Z((k(),C(_,ee({"element-loading-text":"\u4E0A\u4F20\u4E2D, \u8BF7\u7A0D\u540E...","on-remove":u.handleRemove,"before-remove":e.beforeRemove,"before-upload":e.beforeUpload,"http-request":u.httpRequest,action:"string","file-list":d.fileList,"on-exceed":u.handleExceed,accept:e.accept,limit:e.limit,multiple:e.multiple,"on-preview":t.handlePreview,"list-type":e.listType},t.$attrs,{"show-file-list":!1}),{tip:m(()=>[F("div",re,O(e.tips),1)]),default:m(()=>[i(o,{type:"primary"},{default:m(()=>[D(" \u66F4\u65B0\u6587\u4EF6 ")]),_:1})]),_:1},16,["on-remove","before-remove","before-upload","http-request","file-list","on-exceed","accept","limit","multiple","on-preview","list-type"])),[[g,d.loading.httpRequest]])])}var ue=V(se,[["render",ie]]);const I={INIT:"INIT",DEPLOY:"DEPLOY"},z=[{label:"\u521D\u59CB\u72B6\u6001",value:I.INIT},{label:"\u90E8\u7F72\u72B6\u6001",value:I.DEPLOY}],pe=[{prop:"areaName",label:"\u9886\u57DF\u540D\u79F0",type:"input",attrs:{placeholder:"\u8BF7\u8F93\u5165\u9886\u57DF\u540D\u79F0"},rules:[{required:!0,message:"\u8BF7\u8F93\u5165",trigger:"input"}]},{prop:"desc",label:"\u9886\u57DF\u63CF\u8FF0",type:"input",attrs:{placeholder:"\u8BF7\u8F93\u5165\u9886\u57DF\u63CF\u8FF0"},rules:[{required:!0,message:"\u8BF7\u8F93\u5165",trigger:"input"}]},{prop:"sdkUrl",label:"\u9886\u57DFsdk\u7684url",type:"input",attrs:{placeholder:"\u8BF7\u8F93\u5165\u9886\u57DFsdk\u7684url"},rules:[{required:!0,message:"\u8BF7\u8F93\u5165",trigger:"input"}],render:t=>{const a=e=>{var n;t.sdkUrl=(n=e[0])==null?void 0:n.fileUrl};return i(p("el-row"),{align:"middle",justify:"space-between"},{default:()=>[!N(t.sdkUrl)&&i("div",{class:"sdk-url-text "},[i(p("yun-ellipsis"),{text:t.sdkUrl,"visible-line":2},null)]),i("div",null,[i(ue,{onFileChange:a,className:"flex1"},null)])]})}},{prop:"sdkName",label:"sdk\u540D\u79F0",type:"input",attrs:{placeholder:"\u8BF7\u8F93\u5165sdk\u540D\u79F0"},rules:[{required:!0,message:"\u8BF7\u8F93\u5165",trigger:"input"}]},{prop:"scanClassPath",label:"\u626B\u63CF\u5305\u7684\u8DEF\u5F84",type:"input",attrs:{placeholder:"\u8BF7\u8F93\u5165\u626B\u63CF\u5305\u7684\u8DEF\u5F84"},rules:[{required:!0,message:"\u8BF7\u8F93\u5165",trigger:"input"}]},{prop:"sdkStatus",label:"sdk-\u7684status",type:"select",enums:z,rules:[{required:!0,message:"\u8BF7\u9009\u62E9",trigger:"input"}]}],de={__name:"edit",emits:["success"],setup(t,{expose:a,emit:e}){const n=f(!1),d=f(),u=()=>({sdkUrl:""}),o=f(u()),_=y=>{n.value=!0,N(y)?o.value=u():o.value=JSON.parse(JSON.stringify(y))},g=async(y,b)=>{b.value=!0;try{d.value.elForm.validate(async s=>{if(s){const{id:c}=o.value;await(N(c)?H:J)(o.value),y(),E({message:"\u606D\u559C\u4F60\uFF0C\u64CD\u4F5C\u6210\u529F",type:"success"}),e("success")}})}finally{b.value=!1}};return a({open:_}),(y,b)=>{const s=p("yun-pro-form"),c=p("yun-drawer");return k(),C(c,{modelValue:n.value,"onUpdate:modelValue":b[0]||(b[0]=x=>n.value=x),size:"mediun",title:"\u7F16\u8F91","confirm-button-text":"\u786E\u5B9A","cancel-button-text":"\u53D6\u6D88",onConfirm:g},{default:m(()=>[i(s,{ref_key:"formRef",ref:d,form:o.value,columns:R(pe),"form-props":{labelWidth:135},config:{colProps:{span:24}}},null,8,["form","columns"])]),_:1},8,["modelValue"])}}},ce=F("i",{class:"yun-iconfont icon-add"},null,-1);var he={__name:"index",setup(t){const a=f(null),e=f(null),n=l=>{a.value.show(l)},d=l=>{e.value.open(l)},u=[{label:"\u5E8F\u53F7",type:"index"},{label:"\u9886\u57DF\u540D\u79F0",prop:"areaName"},{prop:"desc",label:"\u9886\u57DF\u63CF\u8FF0"},{prop:"sdkUrl",label:"\u9886\u57DFsdk\u7684url"},{prop:"sdkName",label:"sdk\u540D\u79F0"},{prop:"scanClassPath",label:"\u626B\u63CF\u5305\u7684\u8DEF\u5F84"},{prop:"sdkStatus",label:"sdk-\u7684status",render:({row:l})=>{var r;return(r=z.find(({value:v})=>v===l.sdkStatus))==null?void 0:r.label}},{label:"\u64CD\u4F5C",prop:"action",render:({row:l})=>i(p("el-button"),{type:"action",onClick:()=>n(l)},{default:()=>[D("\u67E5\u770B\u8BE6\u60C5")]})}],o=[B("areaName","\u9886\u57DF\u540D\u79F0")],_=f({}),{pagination:g,remoteMethod:y,tableProps:b,proTableRef:s,filterTableData:c}=A({apiFn:Y,extParams:{},extQuerys:{sort:"createTime__DESC"},optimize:!0,async paramsHandler(l){return{...JSON.parse(JSON.stringify(l))}},responseHandler(l){const{areaModes:r,total:v=50}=l;return{records:r,total:v}},plugins:{config:{columns:u,searchFields:o},list:["SEARCH_PLUS"]}}),x=async({searchData:l,filterData:r,pagination:v})=>{const U={...l,page:v.page,size:v.pageSize};return y({searchData:U,filterData:r,pagination:v})},S=async l=>{await W({areaId:l.id}),E.success("\u64CD\u4F5C\u6210\u529F")},w=()=>{s.value.getData(),G().fetchAreaList()};return(l,r)=>{const v=p("el-button"),U=p("yun-pro-table"),M=p("el-card");return k(),q($,null,[i(M,{"body-style":{padding:"0 24px 24px 24px"},shadow:"never"},{default:m(()=>[i(U,{ref_key:"proTableRef",ref:s,pagination:R(g),"onUpdate:pagination":r[1]||(r[1]=h=>P(g)?g.value=h:null),"filter-data":R(c),"onUpdate:filter-data":r[2]||(r[2]=h=>P(c)?c.value=h:null),searchData:_.value,"onUpdate:searchData":r[3]||(r[3]=h=>_.value=h),"search-fields":o,"table-columns":u,"remote-method":x,"table-props":R(b)},{tableHeaderLeft:m(()=>[i(v,{type:"primary",onClick:r[0]||(r[0]=h=>d())},{default:m(()=>[ce,D(" \u65B0\u589E ")]),_:1})]),t_action:m(({row:h})=>[i(v,{type:"action",onClick:K=>d(h)},{default:m(()=>[D(" \u7F16\u8F91 ")]),_:2},1032,["onClick"]),i(v,{type:"action",onClick:K=>S(h)},{default:m(()=>[D(" \u5237\u65B0SDK ")]),_:2},1032,["onClick"])]),_:1},8,["pagination","filter-data","searchData","table-props"])]),_:1}),i(ne,{ref_key:"detailRef",ref:a},null,512),i(de,{ref_key:"editRef",ref:e,onSuccess:w},null,512)],64)}}};export{he as default};
